doctype html
html(lang="en" data-theme="dark")
  head
    meta(charset="UTF-8")
    title CYRUS Â· Canvas
    meta(name="viewport" content="width=device-width, initial-scale=1")
    style.
      :root {
        --transition-fast: 0.15s ease;
        --font-body: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        --radius-pill: 999px;
      }
      :root[data-theme="dark"] {
        --bg-body: radial-gradient(circle at top, #020617 0, #020617 50%, #020617 100%);
        --bg-elevated: rgba(15, 23, 42, 0.98);
        --fg-main: #e5e7eb;
        --fg-muted: #9ca3af;
        --accent-1: #f97316;
        --accent-2: #ec4899;
        --accent-3: #22d3ee;
      }
      :root[data-theme="light"] {
        --bg-body: radial-gradient(circle at top, #fefce8 0, #f3f4f6 40%, #e5e7eb 100%);
        --bg-elevated: rgba(255, 255, 255, 0.98);
        --fg-main: #111827;
        --fg-muted: #6b7280;
        --accent-1: #ea580c;
        --accent-2: #db2777;
        --accent-3: #0ea5e9;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      html, body { height: 100%; }
      body {
        font-family: var(--font-body);
        background: var(--bg-body);
        color: var(--fg-main);
      }

      .page {
        max-width: 1120px;
        margin: 0 auto;
        padding: 16px 16px 26px;
      }
      header.header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 14px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .brand-badge {
        width: 28px;
        height: 28px;
        border-radius: 11px;
        background: conic-gradient(from 120deg, #f97316, #ec4899, #22d3ee, #f97316);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        font-weight: 700;
        color: #fff;
      }
      .brand-text-title {
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }
      .brand-text-sub {
        font-size: 11px;
        color: var(--fg-muted);
      }
      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
      }
      .header-actions a {
        text-decoration: underline;
      }
      .theme-toggle {
        width: 30px;
        height: 30px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(148,163,184,0.6);
        background: rgba(15,23,42,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      :root[data-theme="light"] .theme-toggle {
        background: rgba(255,255,255,0.96);
      }
      .theme-toggle-icon {
        position: absolute;
        font-size: 16px;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }
      .theme-toggle-icon.sun { transform: translateY(0); opacity: 1; }
      .theme-toggle-icon.moon { transform: translateY(200%); opacity: 0; }
      :root[data-theme="light"] .theme-toggle-icon.sun { transform: translateY(-200%); opacity: 0; }
      :root[data-theme="light"] .theme-toggle-icon.moon { transform: translateY(0); opacity: 1; }

      .canvas-shell {
        background: var(--bg-elevated);
        border-radius: 22px;
        padding: 12px 12px 14px;
        border: 1px solid rgba(148,163,184,0.6);
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      }
      .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
        font-size: 11px;
        color: var(--fg-muted);
      }
      .toolbar-left,
      .toolbar-right {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
      }
      .swatches {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .swatch {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        border: 1px solid rgba(15,23,42,0.8);
        cursor: pointer;
        outline: 1px solid transparent;
        transition: transform 0.1s ease, outline 0.1s ease;
      }
      .swatch.active {
        transform: translateY(-2px) scale(1.05);
        outline: 1px solid #fff;
      }
      .brush-size {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      .brush-size input {
        width: 90px;
      }
      button.tool-btn {
        border-radius: var(--radius-pill);
        border: 1px solid rgba(148,163,184,0.7);
        padding: 5px 10px;
        font-size: 11px;
        cursor: pointer;
        background: rgba(15,23,42,0.9);
        color: var(--fg-muted);
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: background 0.15s ease, transform 0.15s ease;
      }
      :root[data-theme="light"] button.tool-btn {
        background: rgba(255,255,255,0.96);
      }
      button.tool-btn:hover {
        transform: translateY(-1px);
        background: rgba(30,64,175,0.7);
        color: #e5e7eb;
      }

      .canvas-wrapper {
        border-radius: 18px;
        padding: 8px;
        background:
          radial-gradient(circle at 0 0, rgba(34,211,238,0.35), transparent 60%),
          radial-gradient(circle at 100% 100%, rgba(236,72,153,0.3), transparent 60%),
          #020617;
      }
      canvas {
        display: block;
        width: 100%;
        max-width: 100%;
        border-radius: 14px;
        background: #020617;
        cursor: crosshair;
      }
      .hint {
        margin-top: 8px;
        font-size: 11px;
        color: var(--fg-muted);
        text-align: right;
      }

  body
    .page
      header.header
        .brand
          .brand-badge C
          div
            .brand-text-title CYRUS
            .brand-text-sub Live canvas
        .header-actions
          a(href="/gallery") â† Back to gallery
          button#themeToggle.theme-toggle(type="button" aria-label="Toggle colour theme")
            span.theme-toggle-icon.sun â˜€ï¸
            span.theme-toggle-icon.moon ðŸŒ™

      .canvas-shell
        .toolbar
          .toolbar-left
            span(style="font-size:11px;") Brush colour
            .swatches
              each color in ['#f97316','#ec4899','#22d3ee','#22c55e','#eab308','#ef4444','#a855f7']
                div.swatch(data-color=color style=`background:${color}`)
          .toolbar-right
            .brush-size
              span Size
              input#brushRange(type="range" min="1" max="20" value="4")
            button#clearBtn.tool-btn(type="button") ðŸ§¼ Clear
            button#saveBtn.tool-btn(type="button") ðŸ’¾ Save

        .canvas-wrapper
          // width/height real pixels; CSS scales
          canvas#cyrusCanvas(width="900" height="480") Your browser does not support canvas.

        .hint
          | Hint: draw with mouse or touch Â· hook "Save" to your Express route later.

    script.
      // Theme toggle with persistence
      (function () {
        const root = document.documentElement;
        const toggle = document.getElementById("themeToggle");
        if (!toggle) return;
        const stored = localStorage.getItem("portfolio-theme");
        if (stored === "light" || stored === "dark") {
          root.setAttribute("data-theme", stored);
        }
        toggle.addEventListener("click", () => {
          const current = root.getAttribute("data-theme") || "dark";
          const next = current === "dark" ? "light" : "dark";
          root.setAttribute("data-theme", next);
          localStorage.setItem("portfolio-theme", next);
        });
      })();

      // Simple canvas drawing logic
      (function () {
        const canvas = document.getElementById('cyrusCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let currentColor = '#f97316';
        let brushSize = 4;

        const rect = () => canvas.getBoundingClientRect();

        function getPos(e) {
          const r = rect();
          if (e.touches && e.touches.length) e = e.touches[0];
          return {
            x: (e.clientX - r.left) * (canvas.width / r.width),
            y: (e.clientY - r.top) * (canvas.height / r.height)
          };
        }

        function startDraw(e) {
          drawing = true;
          const { x, y } = getPos(e);
          ctx.beginPath();
          ctx.moveTo(x, y);
        }
        function draw(e) {
          if (!drawing) return;
          const { x, y } = getPos(e);
          ctx.lineTo(x, y);
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = brushSize;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.stroke();
        }
        function stopDraw() {
          drawing = false;
          ctx.closePath();
        }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stopDraw);

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, { passive: false });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, { passive: false });
        canvas.addEventListener('touchend', (e) => { e.preventDefault(); stopDraw(e); }, { passive: false });

        // Swatches
        const swatches = document.querySelectorAll('.swatch');
        swatches.forEach((sw) => {
          sw.addEventListener('click', () => {
            swatches.forEach(s => s.classList.remove('active'));
            sw.classList.add('active');
            currentColor = sw.getAttribute('data-color');
          });
        });
        if (swatches[0]) swatches[0].classList.add('active');

        // Brush size
        const range = document.getElementById('brushRange');
        if (range) {
          range.addEventListener('input', () => {
            brushSize = parseInt(range.value, 10) || 4;
          });
        }

        // Clear
        document.getElementById('clearBtn')?.addEventListener('click', () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Save hook
        document.getElementById('saveBtn')?.addEventListener('click', () => {
          const dataUrl = canvas.toDataURL('image/png');
          // TODO: send to backend, e.g. via fetch('/canvas/save', { method:'POST', body: JSON.stringify({ image: dataUrl }) ... })
          alert('Canvas exported as data URL. Wire this button to your Express route to save.');
        });
      })();
